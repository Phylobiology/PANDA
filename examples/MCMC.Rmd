---
title: "Examples Panda MCMC"
author: "Florian Hartig"
output:
  html_document:
    keep_md: yes
---

Loading the package and the functions

```{r}
require(RPANDA)
source("../R/fit_bd.R")
```


```{r}
data(Cetacea)
tot_time<-max(node.age(Cetacea)$ages)
```

Fit the pure birth model (no extinction) with a constant speciation rate


```{r, echo=F, warning=F}
f.lamb <-function(t,y){y[1]}
f.mu<-function(t,y){0}
lamb_par<-c(0.09)
mu_par<-c()

prior = BayesianTools::createUniformPrior(lower = c(0), upper = c(1))

result_cst <- fit_bd(Cetacea,tot_time,f.lamb,f.mu,lamb_par,mu_par, f=87/89,cst.lamb=TRUE,fix.mu=TRUE,dt=1e-3, mcmc = T, mcmcSettings = list(iterations = 3000))
```

For using 

```{r}
library(BayesianTools)
plot(result_cst$mcmc)
summary(result_cst$mcmc)
DIC(result_cst$mcmc)
#marginalLikelihood(result_cst$mcmc)
```



```{r}
f.lamb <-function(t,y){y[1] * exp(y[2] * t)}
f.mu<-function(t,y){0}
lamb_par<-c(0.05, 0.01)
mu_par<-c()

prior = BayesianTools::createUniformPrior(lower = c(0,-1), upper = c(5,1))

result_exp <- fit_bd(Cetacea,tot_time,f.lamb,f.mu,lamb_par,mu_par,f=87/89,expo.lamb=TRUE,fix.mu=TRUE,dt=1e-3, mcmc = T, mcmcSettings = list(iterations = 5000), prior = prior)
```

```{r}
library(BayesianTools)
plot(result_exp$mcmc, start = 2500)
summary(result_exp$mcmc, start = 2500)
marginalPlot(result_exp$mcmc, start = 2500)
correlationPlot(result_exp$mcmc, start = 2500)
DIC(result_exp$mcmc, start = 2500)
marginalLikelihood(result_cst$mcmc, start = 2500)
```



